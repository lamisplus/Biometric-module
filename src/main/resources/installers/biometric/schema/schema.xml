<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">

    <property name="autoIncrement" value="true"/>

    <changeSet id="20220306-006" author="amos-data-fi">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="biometric"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE biometric
            (
                id                 VARCHAR(255) NOT NULL,
                created_date       TIMESTAMP WITHOUT TIME ZONE,
                created_by         VARCHAR(255),
                last_modified_date TIMESTAMP WITHOUT TIME ZONE,
                last_modified_by   VARCHAR(255),
                facility_id        BIGINT,
                person_uuid        VARCHAR(255)       NOT NULL,
                template           BYTEA  NOT  NULL ,
                biometric_type     VARCHAR(255),
                template_type      VARCHAR(255),
                enrollment_date    date,
                archived           INTEGER,
                iso                BOOLEAN,
                extra              JSONB,
                device_name        VARCHAR(255),
                CONSTRAINT pk_biometric PRIMARY KEY (id)
            );
        </sql>
    </changeSet>
    <changeSet id="20220706-007" author="amos-data-fi">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="biometric_device"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE "biometric_device"
            (
                id     BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
                name   VARCHAR(255),
                url    VARCHAR(255),
                active BOOLEAN,
                CONSTRAINT "pk_biometric-device" PRIMARY KEY (id)
            );
        </sql>
    </changeSet>

    <changeSet failOnError="false" author="Emeka Ilozue" id="20221406-001">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM biometric_device WHERE name='SG_DEV_AUTO';
            </sqlCheck>
        </preConditions>
        <sql>
            INSERT INTO biometric_device(name, active)VALUES ('SG_DEV_AUTO', 'true');
        </sql>
    </changeSet>
</databaseChangeLog>
